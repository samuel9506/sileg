<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:html5="http://xmlns.jcp.org/jsf/passthrough"      
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:f="http://xmlns.jcp.org/jsf/core">



    <ui:composition>
        <!-- **********************************************************************************************************************************************************
         MAIN CONTENT
         *********************************************************************************************************************************************************** -->

        <section id="main-content">
            <section class="wrapper">
                <h:form>
                    <div class="row" style="margin-top: 15px;">
                        <c:forEach items="#{categoriasView.listaCategorias}" var="cate">
                            <h:commandLink action="#{categoriasView.seleccionCategoria(cate.idcategoria)}" >
                                <div class="col-lg-2 col-md-2 col-sm-2 mb">
                                    <div class="weather-3 pn centered" style="background:">

                                        <br/>
                                        <br/>
                                        <div class="info">
                                            <div class="row">
                                                <h3 class="centered">#{cate.nombre}</h3>
                                                <div class="col-sm-12 col-xs-12 pull-right">
                                                    <p class="goright"><i class="fa fa-flag"></i> #{categoriasView.cantidadproductoscategoria(cate.idcategoria)} Productos</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </h:commandLink>
                        </c:forEach>            
                    </div>
                </h:form>

                <div class="row">
                    <h1> Categoria -> #{categoriasView.categoriaSelect.nombre} </h1>
                </div>


                <div class="row">
                    <h:panelGroup id="tabla">
                        <c:forEach items="#{categoriasView.listaProductos()}" var="pt">
                            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                                <div class="custom-box">
                                    <div class="project-wrapper">
                                        <div class="project">
                                            <div class="photo-wrapper">
                                                <div class="photo">
                                                    <a class="fancybox" href="/images/#{pt.imagenRuta}">
                                                        <h:graphicImage class="img-responsive" style="display: inherit" value="/images/#{pt.imagenRuta}" alt=""/>
                                                    </a>
                                                </div>
                                                <div class="overlay"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="servicetitle">
                                        <h4>#{pt.nombreProducto}</h4>
                                        <hr/>
                                    </div>
                                    <div class="icn-main-container" style="height: 128px !important;">
                                        <span class="icn-container" style="font-size: inherit;">$ #{pt.presentacion}</span>
                                    </div>
                                    <p>Precio Venta : #{pt.precioVenta}</p>
                                    <ul class="pricing">
                                        <li>Puntos : #{pt.puntos}</li>
                                    </ul>

                                    <h:commandButton class="btn btn-primary" value="Comprar" html5:data-toggle="modal" html5:href="#myModal1">
                                        <f:ajax execute="@this" event="click"  render="actualizar-p" listener="#{detallesSession.agregar(pt)}"></f:ajax>
                                    </h:commandButton> 
                                </div>
                                <!-- end custombox -->
                            </div>

                        </c:forEach>
                    </h:panelGroup>
                </div>

                <div class="row">
                    <a class="btn btn-success btn-xs" data-toggle="modal" href="#myModal"> New Product</a>
                </div>

                <div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="myModal1" class="modal fade">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h4 class="modal-title">Compra Producto</h4>
                            </div>
                            <div class="modal-body">
                                <h:form id="actualizar-p">

                                    <h:inputHidden value="#{detallesSession.productoSeleccionado.idproductos}"></h:inputHidden>
                                    <div class="form-group">
                                        <label class="col-lg-2 control-label">Producto</label>
                                        <div class="col-lg-6">
                                            <h:inputText html5:placeholder="#{detallesSession.productoSeleccionado.nombreProducto}"></h:inputText>
                                        </div>

                                        <h:commandButton>
                                            <f:ajax execute="@this" event="click"  render="actualizar-p" listener="#{detallesSession.agregarCarro()}"></f:ajax>     
                                        </h:commandButton>
                                        
                                            <table class="responsive ">
                                                <thead>
                                                    <tr>
                                                        <th>Producto</th>
                                                        <th>Cantidad</th>
                                                        <th>Precio Venta</th>
                                                        <th>Subtotal</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <c:forEach items="#{detallesSession.listaDetalles}" var="detalle">
                                                        <tr>
                                                            <td><h:inputText value="#{detalle.fkProductos.nombreProducto}" disabled="true"></h:inputText></td>

                                                            <td>
                                                                <h:inputText  value="#{detalle.cantidad}">
                                                                    <f:ajax render="totalunidades#{detalle.fkProductos.idproductos}" execute="@this" event="keyup" listener="#{detallesSession.calcularSubtotal(detalle)}"></f:ajax>
                                                                </h:inputText>
                                                            </td>
                                                            <td><h:inputText value="#{detalle.fkProductos.precioVenta}" disabled="true"></h:inputText></td>

                                                            <td><h:inputText id="totalunidades#{detalle.fkProductos.idproductos}" value="#{detalle.totalunidades}" disabled="true"> ></h:inputText></td>
                                                        </tr>
                                                    </c:forEach>

                                                </tbody>
                                            </table>
                                        </div>
                                   <h:commandButton  action="#{detallesSession.agregarFactura()}" class="btn btn-outline-primary float-right  mt-2 mb-2 mr-2"><i class="fas fa-save"></i> Guardar y enviar</h:commandButton>
                                </h:form> 
                            </div>

                        </div>
                    </div>
                </div>


                <div aria-hidden="true" aria-labelledby="myModalLabel" role="dialog" tabindex="-1" id="myModal" class="modal fade">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h4 class="modal-title">Registro Producto Nuevo</h4>
                            </div>
                            <h:form  id="cargaArchivo" enctype="multipart/form-data">
                                <div class="modal-body">
                                    <div class="login-wrap">
                                        <h:selectOneMenu id="idCat" value="#{productosView.id_categoria}" class="form-control">
                                            <f:selectItems itemLabel="#{cat.nombre}" itemValue="#{cat.idcategoria}" value="#{categoriasView.listaCategorias}" var="cat"></f:selectItems>
                                        </h:selectOneMenu>
                                        <br/>
                                        <h:inputText  value="#{productosView.regProductos.nombreProducto}" class="form-control" html5:placeholder="Nombre" html5:autofocus="true"/>
                                        <br/>
                                        <h:inputText  value="#{productosView.regProductos.presentacion}" class="form-control" html5:placeholder="Presentacion" html5:autofocus="true"/>
                                        <br/>
                                        <h:inputText value="#{productosView.regProductos.existencias}" class="form-control" html5:placeholder="Cantidad" html5:autofocus="true"/>
                                        <br/>
                                        <h:inputText  value="#{productosView.regProductos.precioCompra}"  class="form-control" html5:placeholder="Valor Compra" html5:autofocus="true"/>
                                        <br/>
                                        <h:inputText  value="#{productosView.regProductos.precioVenta}"  class="form-control" html5:placeholder="Valor Venta" html5:autofocus="true"/>

                                    </div>
                                    <div class="row">
                                        <div class="col-md-6">

                                            <div class="project-wrapper">
                                                <div class="project">
                                                    <div class="photo-wrapper">
                                                        <div class="photo">
                                                            <a class="fancybox" href="#{request.contextPath}/images/#{categoriasView.rutaImg}">

                                                                <h:graphicImage class="img-responsive" style="display: inherit"  id="imgProducto" value="/images/#{categoriasView.rutaImg}" />

                                                            </a>
                                                        </div>
                                                        <div class="overlay"></div>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                        <div class="col-md-6" style="text-align: center;">
                                            <h:inputFile id="cargaImagen" style="display: none"  onchange="$('#cargaArchivo\\:btnCargaImagen').click();" value="#{categoriasView.filePart}"  >

                                            </h:inputFile>
                                            <h:commandButton id="btnCargaImagen"  style="display: none" action="#{categoriasView.accion(productosView.id_categoria)}" >
                                                <f:ajax render="imgProducto"   execute="cargaArchivo:idCat cargaArchivo:cargaImagen"></f:ajax>
                                            </h:commandButton>

                                            <a onclick="$('#cargaArchivo\\:cargaImagen').click();" class="btn btn-theme"> Image</a>
                                        </div>

                                    </div>

                                </div>
                                <div class="modal-footer">
                                    <button data-dismiss="modal" class="btn btn-default" type="button">Cancel</button>
                                    <h:commandButton onclick="window.location.reload()" action="#{productosView.registrarProductos()}" class="btn btn-theme" value="Register"/>
                                </div>
                            </h:form>
                        </div>
                    </div>
                </div>


            </section>
        </section>


    </ui:composition>
</html>

